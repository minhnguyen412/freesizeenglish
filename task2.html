<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IELTS WRITING PRACTICE - TASK 1</title>
<link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&family=Quicksand:wght@500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="css/post-styles.css">
<style>
:root {
  --black:        #1a1a1a;
  --red:          #ea3324;
  --red-dark:     #b71c1c;
  --red-light:    #ffd5d5;
  --red-pale:     #fff5f5;
  --cream:        #fffef5;
  --white:        #ffffff;
  --yellow:       #ffd84d;
  --yellow-pale:  #fffbe6;
  --orange-pale:  #feefdb;
  --orange:       #fa9f33;
  --blue-pale:    #d8ebff;
  --blue:         #1e86fb;
  --sky-pale:     #eaf8ff;
  --green:        #4caf50;
  --green-pale:   #f0fff0;
  --green-dark:   #2e7d32;
  --pink:         #ffadc5;
  --pink-pale:    #fff2f6;
  --border:       2.5px solid var(--black);
  --border-thick: 3px solid var(--black);
  --shadow-sm:    3px 3px 0 var(--black);
  --shadow-md:    4px 4px 0 var(--black);
  --shadow-lg:    6px 6px 0 var(--black);
}

*, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
html { scroll-behavior: smooth; }

body {
  font-family: 'Fredoka', sans-serif; font-weight: 500;
  background: var(--cream); color: var(--black);
  min-height: 100vh; display: flex; flex-direction: column;
  overflow-x: hidden;
}
body::before {
  content: ''; position: fixed; inset: 0;
  background-image: radial-gradient(circle, rgba(0,0,0,0.04) 1px, transparent 1px);
  background-size: 22px 22px; pointer-events: none; z-index: 0;
}

/* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
header {
  background: var(--red); border-bottom: var(--border-thick);
  padding: 0 50px; height: 66px;
  display: flex; justify-content: space-between; align-items: center;
  position: sticky; top: 0; z-index: 100;
}
header h1 { font-weight: 700; font-size: 1.7rem; color: white; letter-spacing: 0.05em; text-shadow: 2px 2px 0 rgba(0,0,0,0.2); }
.homepage-link { text-decoration: none; color: inherit; }
.menu-toggle { display: none; font-size: 24px; background: none; border: none; color: white; cursor: pointer; }
nav ul { list-style: none; display: flex; gap: 8px; align-items: center; }
nav ul li a {
  text-decoration: none; color: var(--black); font-weight: 700; font-size: 0.95rem;
  background: var(--white); border: var(--border); border-radius: 50px;
  padding: 6px 18px; display: inline-block; box-shadow: var(--shadow-sm);
  transition: transform 0.12s, box-shadow 0.12s;
}
nav ul li a:hover { transform: translate(-2px,-2px); box-shadow: var(--shadow-md); }

/* ‚îÄ‚îÄ LAYOUT ‚îÄ‚îÄ */
.container {
  display: flex; gap: 26px; padding: 36px 56px 100px;
  max-width: 1380px; margin: 0 auto; width: 100%;
  position: relative; z-index: 1; flex: 1;
}
.main-col { flex: 2; display: flex; flex-direction: column; gap: 22px; min-width: 0; }
.side-col {
  flex: 1; min-width: 260px; max-width: 320px;
  display: flex; flex-direction: column; gap: 16px;
  position: sticky; top: 88px; align-self: flex-start;
  max-height: calc(100vh - 110px); overflow-y: auto;
}
.side-col::-webkit-scrollbar { width: 4px; }
.side-col::-webkit-scrollbar-thumb { background: var(--red-light); border-radius: 2px; }

/* ‚îÄ‚îÄ CARDS ‚îÄ‚îÄ */
.card { background: var(--white); border: var(--border-thick); border-radius: 22px; box-shadow: var(--shadow-md); padding: 26px; }
.card-title {
  display: inline-block; font-weight: 700; font-size: 1rem;
  background: var(--red); color: white; border: var(--border); border-radius: 50px;
  padding: 5px 20px; box-shadow: var(--shadow-sm); margin-bottom: 18px; letter-spacing: 0.05em;
}
.card-title.yellow { background: var(--yellow); color: var(--black); }
.card-title.blue   { background: var(--blue);   color: white; }
.card-title.green  { background: var(--green);  color: white; }
.card-title.sky    { background: var(--sky-pale); color: var(--black); border-color: var(--black); }

/* ‚îÄ‚îÄ POST CONTENT ‚îÄ‚îÄ */
#post-container { font-family: 'Quicksand', sans-serif; font-size: 1rem; font-weight: 600; line-height: 1.8; color: #333; }
#post-container img { display: block; margin: 16px auto; max-width: 100%; height: auto; border-radius: 12px; border: var(--border); }
.content-list { list-style: none; display: flex; flex-direction: column; gap: 14px; }
.content-list li {
  display: flex; flex-direction: column;
  background: var(--yellow-pale); border: var(--border); border-radius: 16px;
  padding: 14px 18px; transition: box-shadow 0.15s;
}
.content-list li:nth-child(even) { background: var(--red-pale); }
.content-list li:hover { box-shadow: var(--shadow-md); }

/* ‚îÄ‚îÄ SIDEBAR ‚îÄ‚îÄ */
.sidebar-card { background: var(--white); border: var(--border-thick); border-radius: 22px; box-shadow: var(--shadow-md); padding: 18px; }
.sidebar-card h3 {
  display: inline-block; font-weight: 700; font-size: 1rem;
  background: var(--red); color: white; border: var(--border); border-radius: 50px;
  padding: 5px 18px; box-shadow: var(--shadow-sm); margin-bottom: 16px;
}
.lesson-item {
  display: flex; gap: 12px; align-items: center;
  border: var(--border); border-radius: 14px; background: var(--cream);
  margin-bottom: 10px; transition: transform 0.12s, box-shadow 0.12s; overflow: hidden;
}
.lesson-item:hover { transform: translate(-2px,-2px); box-shadow: var(--shadow-sm); }
.lesson-item a { text-decoration: none; color: inherit; display: flex; gap: 10px; align-items: center; width: 100%; padding: 10px 12px; }
.lesson-emoji { width: 44px; height: 44px; border-radius: 10px; border: var(--border); display: flex; align-items: center; justify-content: center; font-size: 1.4rem; flex-shrink: 0; }
.lesson-item:nth-child(3n+1) .lesson-emoji { background: var(--yellow-pale); }
.lesson-item:nth-child(3n+2) .lesson-emoji { background: var(--red-light); }
.lesson-item:nth-child(3n+3) .lesson-emoji { background: var(--sky-pale); }
.lesson-info h4 { font-size: 0.88rem; font-weight: 700; color: var(--black); margin-bottom: 2px; line-height: 1.3; }
.lesson-info p  { font-family: 'Quicksand', sans-serif; font-size: 0.75rem; font-weight: 600; color: #888; }

/* ‚îÄ‚îÄ QUIZ ‚îÄ‚îÄ */
.qcontainer { background: var(--white); border: var(--border-thick); border-radius: 22px; box-shadow: var(--shadow-md); padding: 28px 26px; }
.quiz-header { display: flex; align-items: center; justify-content: space-between; gap: 12px; margin-bottom: 20px; flex-wrap: wrap; }
.quiz-title { display: inline-block; font-weight: 700; font-size: 1.15rem; background: var(--yellow); border: var(--border-thick); border-radius: 50px; padding: 8px 24px; box-shadow: var(--shadow-sm); }
.quiz-progress-wrap { background: #eee; border: var(--border); border-radius: 50px; height: 10px; margin-bottom: 6px; overflow: hidden; display: none; }
.quiz-progress-fill { height: 100%; background: var(--red); border-radius: 50px; transition: width 0.35s ease; }
.quiz-counter { font-family: 'Quicksand', sans-serif; font-size: 0.82rem; font-weight: 700; color: #888; margin-bottom: 14px; display: none; }

#start-button {
  font-family: 'Fredoka', sans-serif; font-weight: 700; font-size: 1.2rem;
  background: var(--red); color: white; padding: 12px 36px;
  border: var(--border-thick); border-radius: 50px; box-shadow: var(--shadow-md);
  cursor: pointer; transition: transform 0.12s, box-shadow 0.12s;
}
#start-button:hover { transform: translate(-2px,-2px); box-shadow: var(--shadow-lg); }

/* ‚îÄ‚îÄ SENTENCE ‚îÄ‚îÄ */
.sentence {
  display: none; flex-wrap: wrap; align-items: center; gap: 4px;
  font-family: 'Quicksand', sans-serif; font-size: 1.2rem; font-weight: 600; line-height: 2.4;
  margin-bottom: 16px; background: var(--red-pale); border: var(--border); border-radius: 14px; padding: 16px 18px;
}

/* ‚îÄ‚îÄ BLANK ‚Äî auto-expands to match word width ‚îÄ‚îÄ */
.blank {
  display: inline-flex; align-items: center; justify-content: center;
  min-width: 52px; height: 34px; padding: 0 10px;
  border: 2.5px dashed #bbb; border-radius: 10px;
  background: transparent; color: #999;
  font-family: 'Quicksand', sans-serif; font-weight: 800; font-size: 0.95rem;
  vertical-align: middle; margin: 0 3px;
  /* smooth expand when word is placed */
  transition: min-width 0.12s ease, border-color 0.15s, background 0.15s;
  white-space: nowrap; overflow: hidden;
}
.blank.filled {
  background: var(--sky-pale); border: var(--border); border-style: solid;
  color: var(--black); padding: 0 10px; cursor: pointer;
}
.blank.filled:hover { background: #c8ecff; }
.blank.reveal-correct {
  background: var(--green-pale); border-color: var(--green-dark) !important;
  border-style: solid; color: var(--green-dark); cursor: default;
}
.blank.reveal-wrong {
  background: var(--pink-pale); border-color: #e53935 !important;
  border-style: solid; color: #c0392b; cursor: default;
}

/* ‚îÄ‚îÄ OPTIONS ‚îÄ‚îÄ */
.options { display: none; flex-wrap: wrap; gap: 10px; margin-bottom: 14px; justify-content: flex-start; }
.word {
  font-family: 'Quicksand', sans-serif; font-weight: 800; font-size: 0.95rem;
  padding: 8px 16px; background: var(--white); color: var(--black);
  border: var(--border-thick); border-radius: 12px;
  box-shadow: 0 4px 0 var(--black); cursor: pointer;
  transition: transform 0.1s, box-shadow 0.1s;
  user-select: none; white-space: nowrap; -webkit-tap-highlight-color: transparent;
}
.word:active:not(.used):not(:disabled) { transform: translateY(3px); box-shadow: 0 1px 0 var(--black); }
.word:hover:not(.used):not(:disabled)  { transform: translateY(-2px); box-shadow: 0 6px 0 var(--black); background: var(--yellow-pale); }
.word.used    { visibility: hidden; pointer-events: none; }
.word:disabled { opacity: 0.35; pointer-events: none; }
.word.correct-reveal   { background: var(--green-pale); border-color: var(--green-dark); }
.word.incorrect-reveal { background: var(--pink-pale);  border-color: #e53935; }

/* ‚îÄ‚îÄ RESULT / ACTIONS / SUMMARY ‚îÄ‚îÄ */
.result-bar { display: none; border: var(--border-thick); border-radius: 16px; padding: 14px 18px; margin-bottom: 14px; font-weight: 700; font-size: 1rem; align-items: center; gap: 10px; }
.result-bar.correct   { background: var(--green-pale); border-color: var(--green-dark); color: var(--green-dark); }
.result-bar.incorrect { background: var(--pink-pale);  border-color: #e53935;           color: #c0392b; }

.quiz-actions { display: none; gap: 10px; flex-wrap: wrap; margin-top: 4px; }
.quiz-actions button { font-family: 'Fredoka', sans-serif; font-weight: 700; font-size: 1rem; padding: 10px 26px; border: var(--border-thick); border-radius: 50px; box-shadow: var(--shadow-sm); cursor: pointer; transition: transform 0.12s, box-shadow 0.12s; }
.quiz-actions button:hover { transform: translate(-2px,-2px); box-shadow: var(--shadow-md); }
.btn-next   { background: var(--green);    color: white; }
.btn-retry  { background: var(--red);      color: white; }
.btn-finish { background: var(--yellow);   color: var(--black); }

.score-summary { display: none; text-align: center; padding: 20px 0 8px; }
.score-circle { width: 110px; height: 110px; border-radius: 50%; border: var(--border-thick); margin: 0 auto 16px; display: flex; flex-direction: column; align-items: center; justify-content: center; box-shadow: var(--shadow-lg); font-weight: 700; }
.score-circle .score-num   { font-size: 2rem; line-height: 1; }
.score-circle .score-label { font-size: 0.8rem; color: #666; }
.score-summary h2 { font-size: 1.3rem; margin-bottom: 6px; }
.score-summary p  { color: #666; font-size: 0.95rem; margin-bottom: 18px; font-family: 'Quicksand', sans-serif; }

/* ‚îÄ‚îÄ FIXED TAG ‚îÄ‚îÄ */
.new-words {
  position: fixed; top: 50%; right: 20px; transform: translateY(-50%);
  background: var(--yellow); border: var(--border-thick); border-radius: 20px;
  padding: 10px 14px; box-shadow: var(--shadow-md); font-weight: 700; font-size: 0.88rem; z-index: 50;
  writing-mode: vertical-rl; letter-spacing: 0.05em; transition: transform 0.12s;
}
.new-words:hover { transform: translateY(-50%) translate(-2px,-2px); }
.new-words a { text-decoration: none; color: var(--black); }

/* ‚îÄ‚îÄ FOOTER ‚îÄ‚îÄ */
footer { background: var(--black); color: rgba(255,255,255,0.65); padding: 28px 50px; text-align: center; position: relative; z-index: 1; }
footer .brand { font-weight: 700; color: var(--red-light); font-size: 1.2rem; margin-bottom: 4px; }
footer p { font-size: 0.9rem; font-weight: 500; }
footer .social-icons { margin-top: 14px; display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; }
footer .social-icons a { text-decoration: none; color: var(--black); font-weight: 700; font-size: 0.88rem; background: var(--red-light); border: var(--border); border-radius: 50px; padding: 5px 16px; box-shadow: var(--shadow-sm); transition: transform 0.12s; }
footer .social-icons a:hover { transform: translate(-1px,-2px); }

/* ‚îÄ‚îÄ RESPONSIVE ‚îÄ‚îÄ */
@media (max-width: 1024px) {
  .container { flex-direction: column; padding: 20px 20px 80px; }
  .side-col { max-width: 100%; width: 100%; position: static; max-height: none; overflow: visible; }
  #thumbnails-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px; }
}
@media (max-width: 768px) {
  header { padding: 0 16px; position: relative; }
  .menu-toggle { display: block; }
  nav { display: none; position: absolute; top: 66px; left: 0; right: 0; background: var(--red); border-bottom: var(--border); padding: 12px 0; flex-direction: column; z-index: 99; }
  nav.show { display: flex; }
  nav ul { flex-direction: column; align-items: center; gap: 8px; padding: 6px 0; }
  .container { padding: 14px 14px 80px; gap: 16px; }
  .card { padding: 18px 16px; }
  .sentence { font-size: 1.05rem; padding: 12px 14px; line-height: 2.2; }
  .blank  { height: 30px; font-size: 0.85rem; min-width: 40px; }
  .word   { font-size: 0.88rem; padding: 7px 13px; }
  .qcontainer { padding: 18px 14px; }
  .new-words { right: 10px; }
  footer { padding: 24px 16px; }
}
@media (max-width: 480px) {
  header h1 { font-size: 1.3rem; }
  .sentence { font-size: 0.95rem; }
  .word { font-size: 0.82rem; padding: 6px 11px; }
}
</style>
</head>
<body>

<header>
  <h1><a href="index.html" class="homepage-link">FREESIZE ENGLISH</a></h1>
  <button class="menu-toggle" aria-label="Toggle navigation">&#9776;</button>
  <nav>
    <ul>
      <li><a href="about.html">About Us</a></li>
      <li><a href="courses.html">Courses</a></li>
      <li><a href="shop.html">Shop</a></li>
    </ul>
  </nav>
</header>

<div class="container">
  <div class="main-col">

    <div class="card">
      <div class="card-title">üìÑ Sample IELTS Writing Essay</div>
      <div id="post-container"></div>
      <script src="js/passage.js"></script>
    </div>

    <div class="card">
      <div class="card-title yellow">üîç Sentence-by-Sentence Analysis</div>
      <div class="pcontainer">
        <ul class="content-list" id="itemList"></ul>
      </div>
      <script src="js/passage-sentence.js"></script>
      <script>
        document.addEventListener('DOMContentLoaded', () => {
          const p = new URLSearchParams(window.location.search);
          loadPosts(p.get('postStartId') || '21', p.get('postEndId') || '32', 'itemList');
        });
      </script>
    </div>

    <!-- QUIZ -->
    <div class="qcontainer" id="quiz-container" data-start-id="24" data-end-id="38">
      <div class="quiz-header">
        <span class="quiz-title">üéØ Let's Practice!</span>
      </div>
      <div id="start-container">
        <button id="start-button">‚ñ∂ Start Quiz</button>
      </div>
      <div class="quiz-counter" id="quiz-counter"></div>
      <div class="quiz-progress-wrap" id="quiz-progress-wrap">
        <div class="quiz-progress-fill" id="quiz-progress-fill"></div>
      </div>
      <div class="sentence" id="sentence"></div>
      <div class="options"  id="options"></div>
      <div class="result-bar" id="result-bar"></div>
      <div class="quiz-actions" id="quiz-actions"></div>
      <div class="score-summary" id="score-summary">
        <div class="score-circle" id="score-circle">
          <span class="score-num" id="score-num">0/0</span>
          <span class="score-label">correct</span>
        </div>
        <h2 id="score-title">Quiz Complete!</h2>
        <p  id="score-msg"></p>
        <div class="quiz-actions" style="display:flex;justify-content:center;">
          <button class="btn-retry" id="restart-btn">‚ñ∂ Try Again</button>
        </div>
      </div>
    </div>

  </div>

  <div class="side-col">
    <div class="sidebar-card">
      <h3>Other Lessons</h3>
      <div id="thumbnails-container"></div>
    </div>
  </div>
</div>

<div class="new-words"><a href="newword.html">New Words</a></div>

<footer>
  <p class="brand">FREESIZE ENGLISH</p>
  <p>Learn English through images and videos</p>
  <div class="social-icons">
    <a href="#">Facebook</a><a href="#">YouTube</a>
    <a href="#">TikTok</a><a href="#">Instagram</a>
  </div>
</footer>

<script>
document.addEventListener('DOMContentLoaded', function () {
  const menuToggle = document.querySelector('.menu-toggle');
  const nav = document.querySelector('nav');
  menuToggle.addEventListener('click', function () {
    nav.classList.toggle('show');
    menuToggle.innerHTML = nav.classList.contains('show') ? '&#10005;' : '&#9776;';
  });
});
</script>

<script>
const lessonEmojis = ['‚úçÔ∏è','üìù','üìä','üìà','üó∫Ô∏è','üìâ','üî§','üí¨','üìñ','üåç','üéì','üí°'];
fetch('data/thumb-writing-2.json')
  .then(r => r.json())
  .then(videos => {
    videos.sort((a, b) => b.id - a.id);
    const container = document.getElementById('thumbnails-container');
    videos.slice(0, 10).forEach((video, i) => {
      const emoji = lessonEmojis[i % lessonEmojis.length];
      const div = document.createElement('div');
      div.className = 'lesson-item';
      div.innerHTML = `
        <a href="${video.htmlLink}">
          <div class="lesson-emoji">${emoji}</div>
          <div class="lesson-info">
            <h4>${video.title}</h4>
            <p>${video.description || ''}</p>
          </div>
        </a>`;
      container.appendChild(div);
    });
  })
  .catch(err => console.error('Error:', err));
</script>

<script src="js/fetch-writing-2.js"></script>

<script>
(function () {
  function isImg(s) { return /\.(jpe?g|png|gif|webp|bmp|svg)$/i.test(String(s||'')); }
  function wordHTML(w) { return isImg(w) ? `<img src="${w}" alt="" style="height:40px;border-radius:6px;">` : String(w); }
  function qs(sel) { return document.querySelector(sel); }

  const SFX = {
    click:    new Audio('assets/click.mp3'),
    correct:  new Audio('assets/correct.mp3'),
    incorrect:new Audio('assets/incorrect.mp3'),
    victory:  new Audio('assets/victory.mp3'),
  };
  function play(k) { try { SFX[k].currentTime = 0; SFX[k].play().catch(()=>{}); } catch(e){} }

  let questions = [], curIdx = 0, scoreCorrect = 0;
  let slots = [], revealed = false, wrongLog = [];

  const startCont  = qs('#start-container');
  const startBtn   = qs('#start-button');
  const sentenceEl = qs('#sentence');
  const optionsEl  = qs('#options');
  const resultBar  = qs('#result-bar');
  const actionsEl  = qs('#quiz-actions');
  const progWrap   = qs('#quiz-progress-wrap');
  const progFill   = qs('#quiz-progress-fill');
  const counterEl  = qs('#quiz-counter');
  const summaryEl  = qs('#score-summary');
  const scoreNumEl = qs('#score-num');
  const scoreTitleEl = qs('#score-title');
  const scoreMsgEl   = qs('#score-msg');
  const scoreCircle  = qs('#score-circle');
  const restartBtn   = qs('#restart-btn');

  async function loadQ(startId, endId) {
    try {
      const all = await Promise.all(['data/W-quiz-1.json'].map(u => fetch(u).then(r => r.json())));
      const raw = all.flatMap(d => Array.isArray(d) ? d : (d.questions || []));
      return raw.filter(q => q.id >= startId && q.id <= endId);
    } catch(e) {
      return [
        { id:1, sentence:'She ___ to school every day.',     blanks:[{answer:'goes'}],  words:['goes','go','went','gone'] },
        { id:2, sentence:'The report ___ three main ideas.', blanks:[{answer:'covers'}], words:['covers','cover','covered','has'] },
        { id:3, sentence:'___ the graph shows, sales ___.',  blanks:[{answer:'As'},{answer:'rose'}], words:['As','Since','rose','fall','While','dropped'] },
      ];
    }
  }

  startBtn.addEventListener('click', async () => {
    const qc  = qs('#quiz-container');
    const p   = new URLSearchParams(window.location.search);
    const sId = parseInt(p.get('quizStartId')) || parseInt(qc.dataset.startId) || 1;
    const eId = parseInt(p.get('quizEndId'))   || parseInt(qc.dataset.endId)   || 10;
    questions = await loadQ(sId, eId);
    curIdx = 0; scoreCorrect = 0; wrongLog = [];
    startCont.style.display = 'none';
    progWrap.style.display  = 'block';
    counterEl.style.display = 'block';
    summaryEl.style.display = 'none';
    showQ();
  });

  function showQ() {
    if (curIdx >= questions.length) { showSummary(); return; }
    const q = questions[curIdx];
    revealed = false;
    slots = (q.blanks || []).map(() => null);

    progFill.style.width  = (curIdx / questions.length * 100) + '%';
    counterEl.textContent = `Question ${curIdx + 1} / ${questions.length}`;

    let sentRaw = Array.isArray(q.sentence)
      ? q.sentence.map(t => isImg(t) ? `<img src="${t}" alt="" style="height:44px;border-radius:8px;vertical-align:middle;">` : String(t)).join(' ')
      : String(q.sentence || '');
    let bi = 0;
    sentenceEl.innerHTML = sentRaw.replace(/___/g, () => `<span class="blank" data-bi="${bi++}"></span>`);
    sentenceEl.style.display = 'flex';
    sentenceEl.querySelectorAll('.blank').forEach(el => el.addEventListener('click', () => returnWord(el)));

    const words = [...(q.words || [])].sort(() => Math.random() - 0.5);
    optionsEl.innerHTML = '';
    optionsEl.style.display = 'flex';
    words.forEach(w => {
      const btn = document.createElement('button');
      btn.className = 'word'; btn.dataset.word = String(w);
      btn.innerHTML = wordHTML(w);
      btn.addEventListener('click', () => pickWord(btn));
      optionsEl.appendChild(btn);
    });

    resultBar.className = 'result-bar'; resultBar.style.display = 'none';
    actionsEl.innerHTML = ''; actionsEl.style.display = 'none';
  }

  /* ‚îÄ‚îÄ PICK WORD ‚Üí measure width first, then expand blank ‚îÄ‚îÄ */
  function pickWord(btn) {
    if (revealed || btn.classList.contains('used')) return;
    const emptyBi = slots.findIndex(s => s === null);
    if (emptyBi === -1) return;
    play('click');

    // Measure the word chip width BEFORE hiding it
    const wordW = Math.ceil(btn.getBoundingClientRect().width);

    btn.classList.add('used');
    const blankEl = sentenceEl.querySelector(`[data-bi="${emptyBi}"]`);
    if (!blankEl) return;

    blankEl.innerHTML    = wordHTML(btn.dataset.word);
    blankEl.classList.add('filled');
    blankEl.dataset.word = btn.dataset.word;
    // Expand blank to exactly match the word chip width
    blankEl.style.minWidth = wordW + 'px';

    slots[emptyBi] = { optBtn: btn, word: btn.dataset.word };
    if (slots.every(s => s !== null)) setTimeout(() => checkAnswers(questions[curIdx]), 120);
  }

  /* ‚îÄ‚îÄ RETURN WORD ‚Üí reset blank width ‚îÄ‚îÄ */
  function returnWord(blankEl) {
    if (revealed) return;
    const bi = parseInt(blankEl.dataset.bi);
    const slot = slots[bi];
    if (!slot) return;
    play('click');
    slot.optBtn.classList.remove('used');
    blankEl.innerHTML      = '';
    blankEl.className      = 'blank';
    blankEl.setAttribute('data-bi', String(bi));
    blankEl.removeAttribute('data-word');
    blankEl.style.minWidth = '';   // ‚Üê reset to CSS default
    slots[bi] = null;
    blankEl.addEventListener('click', () => returnWord(blankEl));
  }

  function checkAnswers(q) {
    if (revealed) return;
    revealed = true;
    const blanks = q.blanks || [];
    let allRight = true;
    blanks.forEach((b, i) => {
      const given = slots[i]?.word;
      const ok    = String(given) === String(b.answer);
      if (!ok) { allRight = false; wrongLog.push({ question: String(q.sentence||''), given: String(given||''), answer: String(b.answer) }); }
      const blankEl = sentenceEl.querySelector(`[data-bi="${i}"]`);
      if (blankEl) blankEl.classList.add(ok ? 'reveal-correct' : 'reveal-wrong');
    });
    optionsEl.querySelectorAll('.word').forEach(btn => {
      btn.disabled = true;
      const isAns  = blanks.some(b => String(b.answer) === btn.dataset.word);
      const wasUsed = slots.some(s => s && s.optBtn === btn);
      if (wasUsed && isAns)  btn.classList.add('correct-reveal');
      if (wasUsed && !isAns) btn.classList.add('incorrect-reveal');
      if (!wasUsed && isAns) btn.classList.add('correct-reveal');
    });
    if (allRight) {
      scoreCorrect++; play('correct');
      showResultBar(true, '‚úÖ Correct!');
      showActionBtn(curIdx === questions.length - 1 ? 'finish' : 'next');
    } else {
      play('incorrect');
      showResultBar(false, `‚ùå Correct: ${blanks.map(b => b.answer).join(' / ')}`);
      showActionBtn('retry');
    }
  }

  function showResultBar(ok, msg) {
    resultBar.className    = `result-bar ${ok ? 'correct' : 'incorrect'}`;
    resultBar.textContent  = msg;
    resultBar.style.display = 'flex';
  }

  function showActionBtn(type) {
    actionsEl.innerHTML = ''; actionsEl.style.display = 'flex';
    const btn = document.createElement('button');
    if (type === 'next')   { btn.className = 'btn-next';   btn.textContent = 'Continue ‚Üí';    btn.addEventListener('click', () => { curIdx++; showQ(); }); }
    if (type === 'finish') { btn.className = 'btn-finish'; btn.textContent = 'See Results üèÜ'; btn.addEventListener('click', showSummary); }
    if (type === 'retry')  { btn.className = 'btn-retry';  btn.textContent = 'Try Again üîÑ';   btn.addEventListener('click', () => showQ()); }
    actionsEl.appendChild(btn);
  }

  function showSummary() {
    sentenceEl.style.display = optionsEl.style.display = resultBar.style.display = actionsEl.style.display = 'none';
    progWrap.style.display   = counterEl.style.display = 'none';
    play('victory');
    progFill.style.width = '100%';
    const total = questions.length;
    const pct   = total ? Math.round(scoreCorrect / total * 100) : 0;
    scoreNumEl.textContent = `${scoreCorrect}/${total}`;
    if (pct >= 80) {
      scoreCircle.style.cssText += ';background:var(--green-pale);border-color:var(--green)';
      scoreTitleEl.textContent = 'üéâ Excellent!';
      scoreMsgEl.textContent   = `You got ${scoreCorrect}/${total} correct (${pct}%). Amazing work!`;
    } else if (pct >= 50) {
      scoreCircle.style.cssText += ';background:var(--yellow-pale);border-color:var(--yellow)';
      scoreTitleEl.textContent = 'üëç Good effort!';
      scoreMsgEl.textContent   = `You got ${scoreCorrect}/${total} correct (${pct}%). Keep going!`;
    } else {
      scoreCircle.style.cssText += ';background:var(--pink-pale);border-color:var(--pink)';
      scoreTitleEl.textContent = 'üí™ Keep practising!';
      scoreMsgEl.textContent   = `You got ${scoreCorrect}/${total} correct (${pct}%). Try again!`;
    }
    summaryEl.style.display = 'block';
  }

  restartBtn.addEventListener('click', () => {
    summaryEl.style.display = 'none'; startCont.style.display = 'block';
    progWrap.style.display  = counterEl.style.display = 'none';
    progFill.style.width    = '0%';
    sentenceEl.style.display = optionsEl.style.display = resultBar.style.display = actionsEl.style.display = 'none';
  });

})();
</script>

</body>
</html>
